export function setHTMLSafe(target, htmlString){ if(!target||target.nodeType!==1) throw new TypeError('Invalid target'); if(typeof htmlString!=='string') throw new TypeError('Content must be string'); if(htmlString.length>50000) throw new Error('Content too large'); const allowed=new Set(['SPAN','DIV','P','STRONG','EM','TIME']); const c=document.createElement('div'); c.innerHTML=htmlString; const all=c.querySelectorAll('*'); all.forEach(el=>{ if(!allowed.has(el.tagName)) el.replaceWith(document.createTextNode(el.textContent||'')); [...el.attributes].forEach(a=>{ if(/^on/i.test(a.name)||['style','src','href'].includes(a.name)) el.removeAttribute(a.name); }); }); target.innerHTML=c.innerHTML; } window.setHTMLSafe=setHTMLSafe;